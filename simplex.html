<!DOCTYPE html>
<html>
    <head>
        <title>RO</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script>
            function setAttributes(element, attrs) {
                for(let key in attrs) {
                    element.setAttribute(key, attrs[key]);
                }
            }
            function inArray(needle, haystack) {
                let length = haystack.length;
                for(let i = 0; i < length; i++) {
                    if(haystack[i] == needle)
                        return true;
                }
                return false;
            }
            function print_tab(tab, height)
            {
                for(let i = 0; i < height ; i++)
                {
                    document.write(tab[i] + "<br\>");
                }
                document.write("<br\>");
            }
            function toFloat(num) {
                if (num == null || num == "")
                    return (parseFloat(0));
                return (parseFloat(num));
            }
            function createObjFunction(container, num_vars){
                let title = document.createElement('h1');
                title.innerHTML = 'Fonction objectif';
                container.appendChild(title);
                let table = document.createElement('table');
                setAttributes(table, {'border': 0, 'cellspacing': 2, 'cellpadding': 2});
                let tr = document.createElement('tr');
                let th = document.createElement('th');
                tr.appendChild(th);
                for (let i = 1; i <= num_vars; i++) {
                    let th = document.createElement('th');
                    th.innerHTML = 'x' + '<sub>' + i.toString();
                    th.setAttribute('align', 'center');
                    tr.appendChild(th);
                }
                table.appendChild(tr);
                tr = document.createElement('tr');
                let td = document.createElement('td');
                let select = document.createElement('select');
                select.setAttribute('id', 'fct_obj');
                let option = document.createElement('option');
                option.innerHTML = 'min';
                option.setAttribute('value', 'min');
                select.appendChild(option);
                option = document.createElement('option');
                option.innerHTML = 'max';
                option.setAttribute('value', 'max');
                select.appendChild(option);
                td.appendChild(select);
                tr.appendChild(td);
                for (let i = 1; i <= num_vars; i++) {
                    let td = document.createElement('td');
                    let input = document.createElement('input');
                    setAttributes(input, {'type': 'text', 'size': '2', 'id': 'x' + i.toString()})
                    setAttributes(td, {'align': 'center'});
                    td.appendChild(input);
                    tr.appendChild(td);
                }
                table.appendChild(tr);
                container.appendChild(table);
            }
            function createContraintes(container, num_vars, num_conts) {
                let title = document.createElement('h1');
                title.innerHTML = 'Contraintes';
                container.appendChild(title);
                let table = document.createElement('table');
                setAttributes(table, {'border': 0, 'cellspacing': 2, 'cellpadding': 2});
                let tr = document.createElement('tr');
                let td = document.createElement('td');
                tr.appendChild(td);
                for (let i = 1; i <= num_vars; i++) {
                    let th = document.createElement('th');
                    th.innerHTML = 'x' + '<sub>' + i.toString();
                    th.setAttribute('align', 'center');
                    tr.appendChild(th);
                }
                let th = document.createElement('th');
                th.innerHTML = 'Operator';
                tr.appendChild(th);
                th = document.createElement('th');
                th.innerHTML = 'b';
                tr.appendChild(th);
                table.appendChild(tr);
                for (let i = 1; i <= num_conts; i++) {
                    tr = document.createElement('tr');
                    td = document.createElement('td');
                    td.innerHTML = 'Contraintes ' + i.toString();
                    td.style.width = '120px';
                    tr.appendChild(td);
                    for (let j = 1; j <= num_vars; j++) {
                        let td = document.createElement('td');
                        let input = document.createElement('input');
                        setAttributes(input, {'type': 'text', 'size': '4', 'id': 'coef[' + i.toString() + '][' + j.toString() + ']'});
                        setAttributes(td, {'align': 'center'});
                        td.appendChild(input);
                        tr.appendChild(td);
                    }
                    td = document.createElement('td');
                    td.setAttribute('align', 'center');
                    let select = document.createElement('select');
                    select.setAttribute('id', 'operator' + i.toString());
                    let option = document.createElement('option');
                    option.innerHTML = '&le;';
                    option.setAttribute('value', '<');
                    select.appendChild(option);
                    option = document.createElement('option');
                    option.innerHTML = '&ge;';
                    option.setAttribute('value', '>');
                    select.appendChild(option);
                    option = document.createElement('option');
                    option.innerHTML = '=';
                    option.setAttribute('value', '=');
                    select.appendChild(option);
                    td.appendChild(select);
                    tr.appendChild(td);
                    td = document.createElement('td');
                    let input = document.createElement('input');
                    setAttributes(input, {'type': 'text', 'size': '3', 'id': 'b' + i.toString()});
                    setAttributes(td, {'align': 'center'});
                    td.appendChild(input);
                    tr.appendChild(td);
                    table.appendChild(tr);
                }
                container.appendChild(table);
            }
            function get_array() {
                document.getElementById('array').style.display = 'none';
                num_vars = parseInt(num_vars);
                num_conts = parseInt(num_conts);
                let width = 3 + num_vars;
                let height = 2 + num_conts;
                let e = document.getElementById("fct_obj");
                let fct_obj = e.options[e.selectedIndex].value;
                console.log('il s\'agit de ' + fct_obj);
                for (let k = 1; k <= num_conts; k++) {
                    let operator = document.getElementById("operator" + k.toString()).value;
                    width += 1;
                    if (operator === ">")
                        width += 1;
                }
                console.log('width ' + width.toString() + ' height ' + height.toString());
                let tab = new Array(height);
                for (let i = 0; i < height; i++)  {
                    tab[i] = new Array(width);
                }
                //1er colonne :
                tab[0][0] = "V.B";
                let vars = new Array();
                let is_phase1 = false;
                for (let j = 1; j < height - 1; j++) {
                    let operator = document.getElementById("operator" + j.toString()).value;
                    if (operator === '<')
                        tab[j][0] = 'e' + j.toString();
                    else {
                        tab[j][0] = 'a' + j.toString();
                        is_phase1 = true;
                    }
                    vars.push(tab[j][0]);
                    if (operator === '>')
                        vars.push('e' + j.toString());
                }
                tab[height - 1][0] = "cout";
                //1er ligne :
                let col = num_vars + 1;
                for (let i = 1; i <= num_vars; i++) {
                    tab[0][i] = "x" + i.toString();
                }
                for (let i = 1; i < width - 1; i++) {
                    if (inArray("e" + i.toString(), vars))
                        tab[0][col++] = "e" + i.toString();
                }
                for (let i = 1; i < width - 1; i++) {
                    if (inArray("a" + i.toString(), vars))
                        tab[0][col++] = "a" + i.toString();
                }
                tab[0][col++] = "b";
                tab[0][col++] = "ratio";
                //coef du variables :
                for (let j = 1; j <= num_vars; j++) {
                    for (let i = 1; i <= num_conts; i++) {
                        let x = document.getElementById('coef[' + i.toString() + '][' + j.toString() + ']');
                        tab[i][j] = toFloat(x.value);
                    }
                    console.log('<br />');
                }
                //coef du e/a :
                for (let j = num_vars + 1; j < width - 2; j++) {
                    for (let i = 1; i < height - 1; i++) {
                        if (tab[0][j] === tab[i][0])
                            tab[i][j] = parseFloat('1');
                        else if (tab[0][j][0] === 'e' && tab[i][0][0] === 'a' && tab[0][j][1] === tab[i][0][1])
                            tab[i][j] = parseFloat('-1');
                        else
                            tab[i][j] = parseFloat('0');
                    }
                }
                //coef du b/ratio :
                for (let i = 1; i < height - 1; i++) {
                    tab[i][width - 2] = toFloat(document.getElementById('b' + i.toString()).value);
                    tab[i][width - 1] = undefined;
                }
                //coef du dernier ligne:
                if (is_phase1) {
                    for (let j = 1; j < width - 2; j++) {
                        if (tab[0][j][0] === 'a')
                            tab[height - 1][j] = parseFloat('1');
                        else
                            tab[height - 1][j] = parseFloat('0');
                    }
                }
                else {
                    for (let j = 1; j <= num_vars; j++) {
                        if (tab[0][j][0] === 'x')
                            tab[height - 1][j] = toFloat(document.getElementById('x' + j.toString()).value);
                        else
                            tab[height - 1][j] = parseFloat('0');
                    }
                }
                print_tab(tab, height);

            }
            function set_array() {
                document.getElementById('init').style.display = 'none';
                let container = document.getElementById('array');
		if (parseInt(num_vars) > 15 || parseInt(num_conts) > 15)
		    container.removeAttribute("class");
                createObjFunction(container, num_vars);
                createContraintes(container, num_vars, num_conts);
                let input = document.createElement('input');
                setAttributes(input, {'type':'button', 'value':'Prochain pas →', 'onclick': 'get_array()', 'style': "margin-top: 15px; float: right"})
                container.appendChild(input);
            }

        </script>
    </head>
    <body>
    <div class="center_widget" id="init">
        <table border="5">
            <tr>
                <td width ="250px">Nombre des variables :</td>
                <td>
                    <input type="button" value="-" onclick="var_dec()" />
                    <input  type="text" value="1" disabled="disabled" id="num_vars" size="7" style="text-align:right" />
                    <input type="button" value="+" onclick="var_inc()" />
                </td>
            </tr>
            <tr>
                <td>Nombre des contraintes :</td>
                <td>
                    <input type="button" value="-" onclick="cont_dec()" />
                    <input type="text" value="1" disabled="disabled" id="num_conts" size="7" style="text-align:right" />
                    <input type="button" value="+" onclick="cont_inc()" />
                </td>
            </tr>
        </table>
        <input type="button" value="Prochain pas &rarr;" onclick="set_array()" style="margin-top: 15px; float: right"/>
        <script src="inc_dec.js"></script>
    </div>
    <script>
        //num_vars = document.getElementById('num_vars').value;
        //num_conts = document.getElementById('num_conts').value;
    </script>
    <div class="center_widget" id="array"></div>
    </body>
</html>
